# egg_anonymizer 0.1
# Anonymizes commenters ip adresses
# Eric Eggert
# http://yatil.de/

# .....................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the 'Install plugin' box:
# .....................................................................

YTo5OntzOjQ6Im5hbWUiO3M6MTQ6ImVnZ19hbm9ueW1pemVyIjtzOjY6ImF1dGhvciI7czoxMToiRXJpYyBFZ2dlcnQiO3M6MTA6ImF1dGhvcl91cmkiO3M6MTY6Imh0dHA6Ly95YXRpbC5kZS8iO3M6NzoidmVyc2lvbiI7czozOiIwLjEiO3M6MTE6ImRlc2NyaXB0aW9uIjtzOjMzOiJBbm9ueW1pemVzIGNvbW1lbnRlcnMgaXAgYWRyZXNzZXMiO3M6NDoiaGVscCI7czoxODMyOiI8aDE+QW5vbnltaXplciA8c21hbGw+YnkgRXJpYyBFZ2dlcnQsIHB1Ymxpc2hlZCBhdCA8YSBocmVmPSJodHRwOi8veWF0aWwuZGUiPnlhdGlsLmRlPC9hPjwvc21hbGw+PC9oMT4NCg0KPHA+QWZ0ZXIgYSBjb3VydCBkZWNpc2lvbiBpbiBHZXJtYW55IHdlYnNpdGUgb3duZXJzIGFyZSBub3QgYWxsb3dlZCB0byBzdG9yZSBwZXJzb25hbCBpbmZvcm1hdGlvbiBub3QgbmVjZXNzYXJ5IGZvciBwcm9jZXNzaW5nIGluZm9ybWF0aW9uIChsaWtlIElQcykuIFRoYXQ/cyBlc3BlY2lhbGx5IGltcG9ydGFudCBmb3IgY29tbWVudHMsIHNvIHNpdGUgb3duZXJzIHNob3VsZCBhbm9ueW1pemUgY29tbWVudCBJUCBhZHJlc3NlcyBhZnRlciBjaGVja2luZyB0aGVtLjwvcD4NCjxwPk1vcmUgaW5mb3JtYXRpb24gYXQgPGEgaHJlZj0iaHR0cDovL3d3dy5hZHZpc2lnbi5kZS9kYXRlbnNjaHV0ei8yMDA3LTEwL2RpZS12b3JyYXRzZGF0ZW5zcGVpY2hlcnVuZy1mdWVyLWRlbi1oYXVzZ2VicmF1Y2gtb2Rlci1kYXJmLW1hbi1pcC1hZHJlc3Nlbi1kZXItd2Vic2l0ZWJlc3VjaGVyLXNwZWljaGVybiI+YWR2aXNpZ24uZGU8L2E+IChpbiBHZXJtYW4pLjwvcD4gICAgICAgICAgICANCg0KPGgyPlVzYWdlIEluc3RydWN0aW9uczwvaDI+ICAgICAgDQoNCjxwPlRoaXMgcGx1Z2luIGFkZHMgbGlua3MgZm9yIGFub255bWl6aW5nIGNvbW1lbnRlcnMgSVAgYWRyZXNzZXMgdG8gdGhlIGNvbW1lbnRzIHRhYi4gKEphdmFTY3JpcHQgcmVxdWlyZWQsIGFuZCBUWFAgNC4wLjUgZm9yIGpRdWVyeSk8L3A+DQo8cD5JdCBhZGRzIGEgQW5vbnltaXplciB0YWIgdW5kZXIgRXh0ZW5zaW9ucywgd2hlcmUgYWxsIGNvbW1lbnRzIGNhbiBiZSBhbm9ueW1pemVkIHdpdGggb25lIGNsaWNrLjwvcD4NCg0KPGgxPkFub255bWl6ZXIgPHNtYWxsPnZvbiBFcmljIEVnZ2VydCwgdmVyw7ZmZmVudGxpY2h0IGF1ZiA8YSBocmVmPSJodHRwOi8veWF0aWwuZGUiPnlhdGlsLmRlPC9hPjwvc21hbGw+PC9oMT4NCiAgIA0KPHA+TmFjaCBlaW5lciBHZXJpY2h0c2VudHNjaGVpZHVuZyBpbiBEZXV0c2NobGFuZCBpc3QgZXMgQmV0cmVpYmVybiB2b24gV2Vic2VpdGVuIG5pY2h0IG1laHIgZXJsYXVidCBwZXJzw7ZubGljaGUgSW5mb3JtYXRpb25lbiAod2llIElQcykgZGF1ZXJoYWZ0IHp1IHNwZWljaGVybi4gRGFzIGdpbHQgdm9yIGFsbGVtIGbDvHIgS29tbWVudGFyZSBpbiBUZXh0cGF0dGVybiwgZGVyZW4gSVAtQWRyZXNzZW4gc29sbHRlbiBuYWNoZGVtIHNpZSDDvGJlcnByw7xmdCB3dXJkZW4gZ2Vsw7ZzY2h0IHdlcmRlbi48L3A+DQo8cD5XZWl0ZXJlIEluZm9ybWF0aW9uZW4gdW50ZXIgPGEgaHJlZj0iaHR0cDovL3d3dy5hZHZpc2lnbi5kZS9kYXRlbnNjaHV0ei8yMDA3LTEwL2RpZS12b3JyYXRzZGF0ZW5zcGVpY2hlcnVuZy1mdWVyLWRlbi1oYXVzZ2VicmF1Y2gtb2Rlci1kYXJmLW1hbi1pcC1hZHJlc3Nlbi1kZXItd2Vic2l0ZWJlc3VjaGVyLXNwZWljaGVybiI+YWR2aXNpZ24uZGU8L2E+LjwvcD4gICAgICAgICAgICAgICAgICAgICANCg0KDQo8aDI+VmVyd2VuZHVuZzwvaDI+DQoNCjxwPkRpZXNlcyBQbHVnaW4gZsO8Z3QgZWluZW4gTGluayBpbSBLb21tZW50YXItVGFiIGVpbiwgd2VsY2hlciBlcyBlcmxhdWJ0IGVpbnplbG5lIEtvbW1lbnRhcmUgenUgYW5vbnltaXNpZXJlbi4gKEphdmFTY3JpcHQgdW5kIFRYUCA0LjAuNSB3ZWdlbiBqUXVlcnkgYmVuw7Z0aWd0KTwvcD4NCjxwPlp1ZGVtIGdpYnQgZXMgZWluZW4gQW5vbnltaXplci1UYWIsIGluIGRlbSBhbGxlIEtvbW1lbnRhcmUgYXVmIGVpbm1hbCBhbm9ueW1pc2llcnQgd2VyZGVuIGvDtm5uZW4uPC9wPiI7czo0OiJjb2RlIjtzOjE5OTI6IiMgPD9waHAgLy8gVHJpY2tpbmcgVGV4dE1hdGUNCg0KaWYgKEB0eHBpbnRlcmZhY2UgPT0gJ2FkbWluJykgew0KCWFkZF9wcml2cygnZWdnX2Fub255bWl6ZXInLCcxLDIsMyw0LDUnKTsNCglyZWdpc3Rlcl90YWIoJ2V4dGVuc2lvbnMnLCAnZWdnX2Fub255bWl6ZXInLCAiQW5vbnltaXplciIpOw0KCXJlZ2lzdGVyX2NhbGxiYWNrKCdlZ2dfYW5vbl9qYXZhc2NyaXB0JywgJ2Rpc2N1c3MnKTsNCglyZWdpc3Rlcl9jYWxsYmFjaygnZWdnX2Fub255bWl6ZXInLCAnZWdnX2Fub255bWl6ZXInKTsNCn0NCg0KZnVuY3Rpb24gZWdnX2Fub255bWl6ZXIgKCRldmVudCwgJHN0ZXApIHsNCglpZighJHN0ZXAgb3IgIWluX2FycmF5KCRzdGVwLCANCgkgICAgICAgICAgICBhcnJheSgnZWdnX2Fub25fZG9pdCcsICdlZ2dfYW5vbl90aGVtX2FsbCcNCgkgICAgICAgICAgICAgICAgICApKSl7DQoJCWVnZ19hbm9uX2luaXQoKTsNCgl9IA0KCWVsc2UgJHN0ZXAoKTsNCn0NCmZ1bmN0aW9uIGVnZ19hbm9uX2luaXQoJG1lc3NhZ2U9JycpIHsJDQogICAgcGFnZXRvcCgiQW5vbnltaXplciIsJG1lc3NhZ2UpOyANCgllY2hvKCc8cCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPjxhIGhyZWY9Ij9ldmVudD1lZ2dfYW5vbnltaXplciZzdGVwPWVnZ19hbm9uX3RoZW1fYWxsIj5Bbm9ueW1pemUgYWxsIENvbW1lbnRzITwvYT48L3A+Jyk7DQp9DQoNCmZ1bmN0aW9uIGVnZ19hbm9uX2phdmFzY3JpcHQoKSB7DQoJZWNobyA8PDxqcw0KPHNjcmlwdCB0eXBlPSJ0ZXh0L2phdmFzY3JpcHQiPg0KCXZhciB0YWJsZXJvd3MgPSAkKCd0YWJsZSNsaXN0IHRyJyk7IA0KCXZhciB0aHRleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnQW5vbnltaXplJyk7DQoJdmFyIHRodGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpOw0KCXRodGQuYXBwZW5kQ2hpbGQodGh0ZXh0KTsNCgl0YWJsZXJvd3NbMF0uYXBwZW5kQ2hpbGQodGh0ZCk7DQoNCglmb3IgKHZhciBpID0gMTsgaSA8ICh0YWJsZXJvd3MubGVuZ3RoLTEpOyBpKyspIHsNCgkJdmFyIHRoYXRpZCA9IHRhYmxlcm93c1tpXS5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYScpWzBdLmlubmVySFRNTDsNCgkJdmFyIGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQoJCWxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywoJz9ldmVudD1lZ2dfYW5vbnltaXplciZzdGVwPWVnZ19hbm9uX2RvaXQmaWQ9Jyt0aGF0aWQpKTsNCgkJdmFyIGxpbmt0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ0Fub255bWl6ZcKgaXQhJyk7DQoJCWxpbmsuYXBwZW5kQ2hpbGQobGlua3RleHQpOw0KCQl2YXIgdGFibGVkYXRhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTsNCgkJdGFibGVkYXRhLmFwcGVuZENoaWxkKGxpbmspOw0KCQl0YWJsZXJvd3NbaV0uYXBwZW5kQ2hpbGQodGFibGVkYXRhKTsNCgl9Ow0KPC9zY3JpcHQ+DQpqczsNCn0NCg0KZnVuY3Rpb24gZWdnX2Fub25fZG9pdCgpew0KCXBhZ2V0b3AoJ0Fub255bWl6ZXInKTsNCgkkaWQ9Z3BzKCdpZCcpOw0KCXNhZmVfdXBkYXRlKCJ0eHBfZGlzY3VzcyIsICJpcD0nMTI3LjAuMC4xJyIsICJkaXNjdXNzaWQ9JyIuJGlkLiInIik7IA0KCWVjaG8oJzxwIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+PGEgaHJlZj0iJy4kX1NFUlZFUlsiSFRUUF9SRUZFUkVSIl0uJyI+WnVyw7xjayB6dSBkZW4gS29tbWVudGFyZW4/PC9hPjwvcD4nKTsNCn0NCg0KZnVuY3Rpb24gZWdnX2Fub25fdGhlbV9hbGwoKXsNCgkkZG9uZSA9IHNhZmVfdXBkYXRlKCJ0eHBfZGlzY3VzcyIsICJpcD0nMTI3LjAuMC4xJyIsICIxPTEiKTsgDQoJaWYgKCRkb25lKSB7DQoJCXJldHVybiBlZ2dfYW5vbl9pbml0KCdBbGxlIElQLUFkcmVzc2VuIGVyZm9sZ3JlaWNoIGdlbMO2c2NodC4nKTsNCgl9IGVsc2Ugew0KCQlyZXR1cm4gZWdnX2Fub25faW5pdCgnTXlTUUwtRmVobGVyIGJlaW0gbMO2c2NoZW4gZGVyIElQLURhdGVuLicpOw0KCX0NCn0NCiI7czo0OiJ0eXBlIjtzOjE6IjEiO3M6MzoibWQ1IjtzOjMyOiI3ODQ3ODIwOTI1ODk2MWM2Y2VlZDg5MmQ0OGYwMzYxMiI7fQ==